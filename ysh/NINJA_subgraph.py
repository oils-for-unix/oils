"""
ysh/NINJA_subgraph.py
"""

from __future__ import print_function

from build.ninja_lib import log

_ = log


def NinjaGraph(ru):
    n = ru.n

    ru.comment('Generated by %s' % __name__)

    ru.py_binary('ysh/grammar_gen.py')

    n.rule(
        'grammar-gen',
        # uses shell style
        command='_bin/shwrap/grammar_gen cpp $in $out_dir',
        description='grammar_gen cpp $in $out_dir')

    n.build(
        ['_gen/ysh/grammar_nt.h', '_gen/ysh/grammar_tables.cc'],
        'grammar-gen',
        ['ysh/grammar.pgen2'],
        implicit=['_bin/shwrap/grammar_gen'],
        variables=[('out_dir', '_gen/ysh')],
    )
    n.newline()

    ru.cc_library('//ysh/grammar',
                  srcs=['_gen/ysh/grammar_tables.cc'],
                  deps=['//cpp/pgen2'],
                  generated_headers=[
                      '_gen/ysh/grammar_nt.h',
                  ])
